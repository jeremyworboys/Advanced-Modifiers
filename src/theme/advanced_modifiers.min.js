/*!
 * accounting.js v0.3.2
 * Copyright 2011, Joss Crowcroft
 *
 * Freely distributable under the MIT license.
 * Portions of accounting.js are inspired or borrowed from underscore.js
 *
 * Full details and documentation:
 * http://josscrowcroft.github.com/accounting.js/
 */(function(a,b){function k(a){return!!(a===""||a&&a.charCodeAt&&a.substr)}function l(a){return d?d(a):e.call(a)==="[object Array]"}function m(a){return e.call(a)==="[object Object]"}function n(a,b){var c;a=a||{};b=b||{};for(c in b)b.hasOwnProperty(c)&&a[c]==null&&(a[c]=b[c]);return a}function o(a,b,d){var e,f,g=[];if(!a)return g;if(c&&a.map===c)return a.map(b,d);for(e=0,f=a.length;e<f;e++)g[e]=b.call(d,a[e],e,a);return g}function p(a,b){a=Math.round(Math.abs(a));return isNaN(a)?b:a}function q(a){var b=j.settings.currency.format;typeof a=="function"&&(a=a());return k(a)&&a.match("%v")?{pos:a,neg:a.replace("-","").replace("%v","-%v"),zero:a}:!a||!a.pos||!a.pos.match("%v")?k(b)?j.settings.currency.format={pos:b,neg:b.replace("%v","-%v"),zero:b}:b:a}var c,d,e,f,g,h,i,j={};j.version="0.3.2";j.settings={currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}};c=Array.prototype.map,d=Array.isArray,e=Object.prototype.toString;f=j.unformat=j.parse=function(a,b){if(l(a))return o(a,function(a){return f(a,b)});a=a||0;if(typeof a=="number")return a;b=b||".";var c=new RegExp("[^0-9-"+b+"]",["g"]),d=parseFloat((""+a).replace(/\((.*)\)/,"-$1").replace(c,"").replace(b,"."));return isNaN(d)?0:d};g=j.toFixed=function(a,b){b=p(b,j.settings.number.precision);var c=Math.pow(10,b);return(Math.round(j.unformat(a)*c)/c).toFixed(b)};h=j.formatNumber=function(a,b,c,d){if(l(a))return o(a,function(a){return h(a,b,c,d)});a=f(a);var e=n(m(b)?b:{precision:b,thousand:c,decimal:d},j.settings.number),i=p(e.precision),k=a<0?"-":"",q=parseInt(g(Math.abs(a||0),i),10)+"",r=q.length>3?q.length%3:0;return k+(r?q.substr(0,r)+e.thousand:"")+q.substr(r).replace(/(\d{3})(?=\d)/g,"$1"+e.thousand)+(i?e.decimal+g(Math.abs(a),i).split(".")[1]:"")};i=j.formatMoney=function(a,b,c,d,e,g){if(l(a))return o(a,function(a){return i(a,b,c,d,e,g)});a=f(a);var k=n(m(b)?b:{symbol:b,precision:c,thousand:d,decimal:e,format:g},j.settings.currency),r=q(k.format),s=a>0?r.pos:a<0?r.neg:r.zero;return s.replace("%s",k.symbol).replace("%v",h(Math.abs(a),p(k.precision),k.thousand,k.decimal))};j.formatColumn=function(a,b,c,d,e,g){var i,r,s,t,u;if(!a)return[];i=n(m(b)?b:{symbol:b,precision:c,thousand:d,decimal:e,format:g},j.settings.currency),r=q(i.format),s=r.pos.indexOf("%s")<r.pos.indexOf("%v")?!0:!1,t=0,u=o(a,function(a,b){if(l(a))return j.formatColumn(a,i);a=f(a);var c=a>0?r.pos:a<0?r.neg:r.zero,d=c.replace("%s",i.symbol).replace("%v",h(Math.abs(a),p(i.precision),i.thousand,i.decimal));d.length>t&&(t=d.length);return d});return o(u,function(a){return k(a)&&a.length<t?s?a.replace(i.symbol,i.symbol+(new Array(t-a.length+1)).join(" ")):(new Array(t-a.length+1)).join(" ")+a:a})};if(typeof exports!="undefined"){typeof module!="undefined"&&module.exports&&(exports=module.exports=j);exports.accounting=j}else if(typeof define=="function"&&define.amd)define([],function(){return j});else{j.noConflict=function(c){return function(){a.accounting=c;j.noConflict=b;return j}}(a.accounting);a.accounting=j}})(this);window.jQuery&&window.ExpressoStore&&jQuery(function(a){var b,c,d,e,f,g;if(ExpressoStore.products){b=function(b){var c={},d=a(b).serializeArray();a.each(d,function(a,b){c[b.name]=b.value});return c};c=function(a){var b=ExpressoStore.products[a.entry_id];if(!b)return!1;if(b.stock.length===1)return b.stock[0];for(var c=0;c<b.stock.length;c++){var d=!0;for(var e in b.stock[c].opt_values){var f="modifiers["+e+"]";if(a[f]!=b.stock[c]["opt_values"][e]){d=!1;break}}if(d)return b.stock[c]}return!1};d=function(a,b){var c;try{var d=new Function("scope","with(scope) { return ("+a+"); }");c=parseFloat(d(b))}catch(e){console.log(a,b,e);c=0}return c};e=function(a){return a.toLowerCase().replace(/[^A-Za-z0-9-]+/g,"_")};f=function(a){var b=ExpressoStore.products[a.entry_id];if(!b)return!1;var c=b.price,f={},g,h,i,j;for(h in b.modifiers){i=a["modifiers["+h+"]"];j=b.modifiers[h].options[i];if(j){g=e(b.modifiers[h].mod_name);f[g]=j.opt_name}}for(h in b.modifiers){i=a["modifiers["+h+"]"];j=b.modifiers[h].options[i];j&&(c+=d(j.adv_mod,f))}return c};g=function(){var d="",e="",g=!0,h=b(this.form),i=c(h);if(i!==!1){d=i.sku;if(i.track_stock==="y"){e=i.stock_level;e<=0&&(g=!1)}}var j=a(this.form);a(".store_product_sku",j).val(d).text(d).trigger("change");a(".store_product_stock",j).val(e).text(e).trigger("change");a(".store_product_in_stock",j).toggle(g);a(".store_product_out_of_stock",j).toggle(g===!1);var k=f(h);if(k){var l=ExpressoStore.formatCurrency(k),m=k*(1+ExpressoStore.cart.tax_rate),n=ExpressoStore.formatCurrency(m);a(".store_product_price_val",j).val(k).text(k).trigger("change");a(".store_product_price",j).val(l).html(l).trigger("change");a(".store_product_price_inc_tax_val",j).val(m).text(m).trigger("change");a(".store_product_price_inc_tax",j).val(n).html(n).trigger("change")}};a("form.store_product_form").undelegate('[name^="modifiers"]:not(:radio)',"change").undelegate('[name^="modifiers"]:radio',"click").delegate('[name^="modifiers"]:not(:radio)',"change",g).delegate('[name^="modifiers"]:radio',"click",g).find("input:first").each(g)}});