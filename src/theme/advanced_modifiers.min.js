/*!
 * accounting.js v0.3.2
 * Copyright 2011, Joss Crowcroft
 *
 * Freely distributable under the MIT license.
 * Portions of accounting.js are inspired or borrowed from underscore.js
 *
 * Full details and documentation:
 * http://josscrowcroft.github.com/accounting.js/
 */(function(e,t){function o(e){return!!(e===""||e&&e.charCodeAt&&e.substr)}function u(e){return i?i(e):s.call(e)==="[object Array]"}function a(e){return s.call(e)==="[object Object]"}function f(e,t){var n;e=e||{},t=t||{};for(n in t)t.hasOwnProperty(n)&&e[n]===null&&(e[n]=t[n]);return e}function l(e,t,n){var i=[],s,o;if(!e)return i;if(r&&e.map===r)return e.map(t,n);for(s=0,o=e.length;s<o;s++)i[s]=t.call(n,e[s],s,e);return i}function c(e,t){return e=Math.round(Math.abs(e)),isNaN(e)?t:e}function h(e){var t=n.settings.currency.format;return typeof e=="function"&&(e=e()),o(e)&&e.match("%v")?{pos:e,neg:e.replace("-","").replace("%v","-%v"),zero:e}:!e||!e.pos||!e.pos.match("%v")?o(t)?n.settings.currency.format={pos:t,neg:t.replace("%v","-%v"),zero:t}:t:e}var n={};n.version="0.3.2",n.settings={currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}};var r=Array.prototype.map,i=Array.isArray,s=Object.prototype.toString,p=n.unformat=n.parse=function(e,t){if(u(e))return l(e,function(e){return p(e,t)});e=e||0;if(typeof e=="number")return e;t=t||".";var n=new RegExp("[^0-9-"+t+"]",["g"]),r=parseFloat((""+e).replace(/\((.*)\)/,"-$1").replace(n,"").replace(t,"."));return isNaN(r)?0:r},d=n.toFixed=function(e,t){t=c(t,n.settings.number.precision);var r=Math.pow(10,t);return(Math.round(n.unformat(e)*r)/r).toFixed(t)},v=n.formatNumber=function(e,t,r,i){if(u(e))return l(e,function(e){return v(e,t,r,i)});e=p(e);var s=f(a(t)?t:{precision:t,thousand:r,decimal:i},n.settings.number),o=c(s.precision),h=e<0?"-":"",m=parseInt(d(Math.abs(e||0),o),10)+"",g=m.length>3?m.length%3:0;return h+(g?m.substr(0,g)+s.thousand:"")+m.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+s.thousand)+(o?s.decimal+d(Math.abs(e),o).split(".")[1]:"")},m=n.formatMoney=function(e,t,r,i,s,o){if(u(e))return l(e,function(e){return m(e,t,r,i,s,o)});e=p(e);var d=f(a(t)?t:{symbol:t,precision:r,thousand:i,decimal:s,format:o},n.settings.currency),g=h(d.format),y=e>0?g.pos:e<0?g.neg:g.zero;return y.replace("%s",d.symbol).replace("%v",v(Math.abs(e),c(d.precision),d.thousand,d.decimal))};n.formatColumn=function(e,t,r,i,s,d){if(!e)return[];var m=f(a(t)?t:{symbol:t,precision:r,thousand:i,decimal:s,format:d},n.settings.currency),g=h(m.format),y=g.pos.indexOf("%s")<g.pos.indexOf("%v")?!0:!1,b=0,w=l(e,function(e,t){if(u(e))return n.formatColumn(e,m);e=p(e);var r=e>0?g.pos:e<0?g.neg:g.zero,i=r.replace("%s",m.symbol).replace("%v",v(Math.abs(e),c(m.precision),m.thousand,m.decimal));return i.length>b&&(b=i.length),i});return l(w,function(e,t){return o(e)&&e.length<b?y?e.replace(m.symbol,m.symbol+(new Array(b-e.length+1)).join(" ")):(new Array(b-e.length+1)).join(" ")+e:e})},typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=n),exports.accounting=n):typeof define=="function"&&define.amd?define([],function(){return n}):(n.noConflict=function(r){return function(){return e.accounting=r,n.noConflict=t,n}}(e.accounting),e.accounting=n)})(this),window.jQuery&&window.ExpressoStore&&jQuery(function(e){if(ExpressoStore.products){var t=function(t){var n={},r=e(t).serializeArray();return e.each(r,function(e,t){n[t.name]=t.value}),n},n=function(e){var t=ExpressoStore.products[e.entry_id];if(!t)return!1;if(t.stock.length===1)return t.stock[0];for(var n=0;n<t.stock.length;n++){var r=!0;for(var i in t.stock[n].opt_values){var s="modifiers["+i+"]";if(e[s]!=t.stock[n]["opt_values"][i]){r=!1;break}}if(r)return t.stock[n]}return!1},r=function(e,t){var n;try{var r=new Function("scope","with(scope) { return ("+e+"); }");n=parseFloat(r(t))}catch(i){console.log(e,t,i),n=0}return n},i=function(e){var t=ExpressoStore.products[e.entry_id];if(!t)return!1;var n=t.price,r=[];for(var i in t.modifiers){var s=e["modifiers["+i+"]"],o=t.modifiers[i].options[s];o&&r.push(o.product_opt_id)}var u=r.join("-");return t.stock[0].advanced_modifiers[u]&&(n+=t.stock[0].advanced_modifiers[u]),n},s=function(){var r="",s="",o=!0,u=t(this.form),a=n(u);a!==!1&&(r=a.sku,a.track_stock==="y"&&(s=a.stock_level,s<=0&&(o=!1)));var f=e(this.form);e(".store_product_sku",f).val(r).text(r).trigger("change"),e(".store_product_stock",f).val(s).text(s).trigger("change"),e(".store_product_in_stock",f).toggle(o),e(".store_product_out_of_stock",f).toggle(o===!1);var l=i(u);if(l){var c=ExpressoStore.formatCurrency(l),h=l*(1+ExpressoStore.cart.tax_rate),p=ExpressoStore.formatCurrency(h);e(".store_product_price_val",f).val(l).text(l).trigger("change"),e(".store_product_price",f).val(c).html(c).trigger("change"),e(".store_product_price_inc_tax_val",f).val(h).text(h).trigger("change"),e(".store_product_price_inc_tax",f).val(p).html(p).trigger("change")}};e("form.store_product_form").undelegate('[name^="modifiers"]:not(:radio)',"change").undelegate('[name^="modifiers"]:radio',"click").delegate('[name^="modifiers"]:not(:radio)',"change",s).delegate('[name^="modifiers"]:radio',"click",s).find("input:first").each(s)}});
